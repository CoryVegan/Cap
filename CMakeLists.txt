CMAKE_MINIMUM_REQUIRED(VERSION 3.0)

PROJECT(cap)

SET(CAP_MAJOR_VERSION 0)
SET(CAP_MINOR_VERSION 1)
SET(CAP_PATCH_VERSION 0)
SET(CAP_VERSION
    ${CAP_MAJOR_VERSION}.${CAP_MINOR_VERSION}.${CAP_PATCH_VERSION})

MESSAGE("cap version: ${CAP_VERSION}")

SET(CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake")
SET(CMAKE_FIND_LIBRARY_SUFFIXES ".a;.so;.dylib")

INCLUDE(CheckCompiler)
INCLUDE(SetupTPLs)
INCLUDE(TrackCapRevisionNumber)


INCLUDE_DIRECTORIES(include)
ADD_SUBDIRECTORY(source)

IF(ENABLE_PYTHON)
    ADD_SUBDIRECTORY(python)
ENDIF()
IF(ENABLE_DOCUMENTATION)
    ADD_SUBDIRECTORY(docs)
ENDIF()

ENABLE_TESTING()
ADD_SUBDIRECTORY(test)

SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY lib)
SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY lib)
ADD_LIBRARY(cap ${CAP_SOURCES})

INSTALL(TARGETS cap DESTINATION ${CMAKE_INSTALL_PREFIX}/lib)
INSTALL(DIRECTORY source/
    DESTINATION ${CMAKE_INSTALL_PREFIX}/include/cap
    FILES_MATCHING 
    PATTERN "*.h"
    PATTERN "*.templates.h" EXCLUDE
)

#### OUTDATED ####################################
IF(MAKE_DOC)
    ADD_SUBDIRECTORY(doc)
ENDIF()
##################################################


SET(CMAKE_EXPORT_COMPILE_COMMANDS 1)

